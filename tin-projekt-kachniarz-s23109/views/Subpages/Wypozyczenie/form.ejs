<%- include('../../fragments/header.ejs') %>

    <main>

        <h2><%=pageTitle%></h2>




        <form class="form" method="post" action="<%=formAction%>" novalidate onsubmit="return validateForm();">

            <input type="hidden" name="_id" value="<%=wyp._id%>">

            <label for="ksiazka">Książka: <span class="symbol-required">*</span></label>
            <select name="Ksiazka_id" id="ksiazka" required <%= (formMode == 'showDetails') ? 'disabled' : '' %>>

                <% if (formMode != 'showDetails' ) {%>
                <% /* Przypadek gdzie się nie wczytuje reszty tabel */%>
                    <option <%=(formMode == 'createNew') ? 'selected' : ''%> disabled hidden value="default">--Wybierz Książkę--</option>
                    <% for (let ksi of allKsi) {%>
                    <option value="<%=ksi._id%>"<%=(wyp != null)? ((wyp.Ksiazka_id == ksi._id) ? 'selected' : '' ) : ''%> ><%="\"" + ksi.tytul + "\" ID:"  + ksi._id%></option>
                    <% } %>
                <% } else {%>
                    <option selected disabled><%="\"" + wyp.ksiazka.tytul + "\" ID: " + wyp.ksiazka._id%></option>
                <% } %>


            </select>
            <span id="errorKsiazka" class="error-text"></span>

            <label for="klient">Klient: <span class="symbol-required">*</span></label>
            <select name="Klient_id" id="klient" required <%= (formMode == 'showDetails') ? 'disabled' : '' %>>
                <% if (formMode != 'showDetails' ) {%>
                    <% /* Przypadek gdzie się nie wczytuje reszty tabel */%>
                <option <%=(formMode == 'createNew') ? 'selected' : ''%> disabled hidden value="default">--Wybierz Klienta--</option>
                <% for (let kli of allKli){%>
                    <option value="<%= kli._id%>" <%=(wyp != null)? ((wyp.Klient_id == kli._id) ? 'selected' : '' ) : ''%>><%= kli.imie + " " + kli.nazwisko + " ID:" + kli._id%></option>
                <% } %>
                <% } else {%>
                <option selected hidden ><%=wyp.klient.imie + " " + wyp.klient.nazwisko + " ID:" + wyp.klient._id %></option>
                <% } %>

            </select>
            <span id="errorKlient" class="error-text"></span>

            <label>Data wypożyczenia: <span class="symbol-required">*</span></label>
            <input type="date" name="data_od" id="dateFrom" required value="<%= (wyp != null) ? ((wyp.data_od != null)? wyp.data_od.toISOString().split('T')[0] : '' ) : ''%>"  <%= (formMode == 'showDetails') ? 'disabled' : '' %>>
            <span id="errorDateFrom" class="error-text"></span>

            <label>Data zwrotu:</label>
            <input type="date" name="data_do" id="dateTo" value="<%= (wyp != null) ? ((wyp.data_do != null)? wyp.data_do.toISOString().split('T')[0] : '' ) : ''%>" <%= (formMode == 'showDetails') ? 'disabled' : '' %>>
            <span id="errorDateTo" class="error-text"></span>

            <div class="form-buttons">
                <span id="errorSummary" class="error-text"><%= (validationErrors.length  > 0) ? 'Formularz zawiera błędy' : ''%></span>
                <%if (formMode== 'showDetails') {%>
                    <a href="/wypozyczenie/edit/<%= wyp._id%>" class="button-edit">
                        <img src="/Images/icons8-more-details-64.png" class="button-edit-icon">
                        <span class="button-edit-text">Edytuj</span>
                    </a>
                    <a href="/wypozyczenie" class="button-return">
                        <img src="/Images/icons8-u-turn-to-left-64.png" class="button-return-icon">
                        <span class="button-return-text">Powrót</span>
                    </a>
                <% } else {%>
                <input type="submit" value=<%=btnLabel%> class="form-button-submit">
                <a href="/wypozyczenie" class="form-button-cancel">Powrót</a>
                <% } %>
            </div>


        </form>

    </main>

<%- include('../../fragments/footer.ejs') %>